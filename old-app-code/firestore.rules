rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }

    // TEMPORARILY DISABLED - searchLogs collection is not accessible
    // This prevents the costly get() calls that were causing excessive reads
    match /searchLogs/{logId} {
      // Allow creating search logs (for logging search queries)
      allow create: if true;

      // READS TEMPORARILY DISABLED TO PREVENT FIREBASE COSTS
      // Only re-enable after fixing the read cost issue
      allow read: if false;

      // No updates or deletes allowed
      allow update, delete: if false;
    }

    // users collection rules
    match /users/{userId} {
      // Allow user creation only during account signup
      allow create: if isAuthenticated() &&
                      request.auth.uid == userId &&
                      request.resource.data.role == 'employee' &&
                      request.resource.data.keys().hasAll(['email', 'role', 'createdAt']);

      // Users can read their own document
      allow read: if isAuthenticated() && request.auth.uid == userId;

      // Users can update their own displayName field only
      allow update: if isAuthenticated() &&
                      request.auth.uid == userId &&
                      request.resource.data.diff(resource.data).affectedKeys().hasOnly(['displayName']);

      // No deletes allowed
      allow delete: if false;
    }

    // Deny all other collections by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
